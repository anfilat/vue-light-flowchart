(function(t,e){"object"===typeof exports&&"object"===typeof module?module.exports=e():"function"===typeof define&&define.amd?define([],e):"object"===typeof exports?exports["vue-light-flowchart"]=e():t["vue-light-flowchart"]=e()})("undefined"!==typeof self?self:this,(function(){return function(t){var e={};function n(i){if(e[i])return e[i].exports;var o=e[i]={i:i,l:!1,exports:{}};return t[i].call(o.exports,o,o.exports,n),o.l=!0,o.exports}return n.m=t,n.c=e,n.d=function(t,e,i){n.o(t,e)||Object.defineProperty(t,e,{enumerable:!0,get:i})},n.r=function(t){"undefined"!==typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(t,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(t,"__esModule",{value:!0})},n.t=function(t,e){if(1&e&&(t=n(t)),8&e)return t;if(4&e&&"object"===typeof t&&t&&t.__esModule)return t;var i=Object.create(null);if(n.r(i),Object.defineProperty(i,"default",{enumerable:!0,value:t}),2&e&&"string"!=typeof t)for(var o in t)n.d(i,o,function(e){return t[e]}.bind(null,o));return i},n.n=function(t){var e=t&&t.__esModule?function(){return t["default"]}:function(){return t};return n.d(e,"a",e),e},n.o=function(t,e){return Object.prototype.hasOwnProperty.call(t,e)},n.p="",n(n.s="fb15")}({"2aee":function(t,e,n){"use strict";var i=n("4217"),o=n.n(i);o.a},4217:function(t,e,n){},"4b28":function(t,e,n){},"7b97":function(t,e,n){"use strict";var i=n("4b28"),o=n.n(i);o.a},9226:function(t,e,n){},f579:function(t,e,n){"use strict";var i=n("9226"),o=n.n(i);o.a},f6fd:function(t,e){(function(t){var e="currentScript",n=t.getElementsByTagName("script");e in t||Object.defineProperty(t,e,{get:function(){try{throw new Error}catch(i){var t,e=(/.*at [^\(]*\((.*):.+:.+\)$/gi.exec(i.stack)||[!1])[1];for(t in n)if(n[t].src==e||"interactive"==n[t].readyState)return n[t];return null}}})})(document)},fb15:function(t,e,n){"use strict";var i;(n.r(e),"undefined"!==typeof window)&&(n("f6fd"),(i=window.document.currentScript)&&(i=i.src.match(/(.+\/)[^/]+\.js(\?.*)?$/))&&(n.p=i[1]));var o=function(){var t=this,e=t.$createElement,n=t._self._c||e;return n("div",{staticClass:"flowchart-container",on:{mousemove:t.handleMove,mouseup:t.handleUp,mousedown:t.handleDown}},[n("svg",{attrs:{width:"100%",height:t.height+"px"}},t._l(t.lines,(function(e){return n("flowchart-link",t._b({key:e.id,attrs:{options:t.linkOptions},on:{linkMouseEnter:function(n){return t.linkMouseEnter(e.id)},linkMouseLeave:function(n){return t.linkMouseLeave(e.id)},linkClick:function(n){return t.linkClick(e.id)},deleteLink:function(n){return t.linkDelete(e.id)}}},"flowchart-link",e,!1))})),1),t._l(t.scene.nodes,(function(e){return n("flowchart-node",t._b({key:e.id,attrs:{options:t.nodeOptions},on:{linkingStart:function(n){return t.linkingStart(e.id)},linkingStop:function(n){return t.linkingStop(e.id)},tryLinking:function(n){return t.tryAddNodeToLink(e.id)},nodeMouseEnter:function(n){return t.nodeMouseEnter(e.id)},nodeMouseLeave:function(n){return t.nodeMouseLeave(e.id)},nodeSelected:function(n){return t.nodeSelected(e.id,n)}}},"flowchart-node",e,!1))}))],2)},s=[],r=function(){var t=this,e=t.$createElement,n=t._self._c||e;return n("g",{on:{mousedown:t.handleClick,mouseenter:t.handleMouseEnter,mouseleave:t.handleMouseLeave}},t._l(t.sections,(function(e){return n("g",{key:e.key},[n("path",{style:t.pathStyle,attrs:{d:e.path}}),t.show.delete?n("a",{on:{click:t.deleteLink}},[n("circle",{attrs:{cx:"0",cy:"0",r:"8","fill-opacity":"0",transform:e.transform}}),n("path",{style:t.deleteStyle,attrs:{d:"M -4 -4 L 4 4 M 4 -4 L -4 4",transform:e.transform}})]):n("path",{style:t.arrowStyle,attrs:{d:"M -1 -1 L 0 1 L 1 -1 z",transform:e.transform}})])})),0)},l=[];function c(t,e){return d(t)||u(t,e)||a()}function a(){throw new TypeError("Invalid attempt to destructure non-iterable instance")}function u(t,e){if(Symbol.iterator in Object(t)||"[object Arguments]"===Object.prototype.toString.call(t)){var n=[],i=!0,o=!1,s=void 0;try{for(var r,l=t[Symbol.iterator]();!(i=(r=l.next()).done);i=!0)if(n.push(r.value),e&&n.length===e)break}catch(c){o=!0,s=c}finally{try{i||null==l["return"]||l["return"]()}finally{if(o)throw s}}return n}}function d(t){if(Array.isArray(t))return t}var h={name:"FlowchartLink",props:{id:Number,color:String,segments:Array,options:{type:Object,default:function(){return{scale:1,themeColor:"",labelColor:"",linkWidth:2.73205,canDelete:!0}}}},data:function(){return{show:{delete:!1}}},methods:{handleClick:function(){this.$emit("linkClick")},handleMouseEnter:function(){this.id&&(this.options.canDelete&&(this.show.delete=!0),this.$emit("linkMouseEnter"))},handleMouseLeave:function(){this.id&&(this.options.canDelete&&(this.show.delete=!1),this.$emit("linkMouseLeave"))},deleteLink:function(){this.$emit("deleteLink")}},computed:{sections:function(){var t=this;return this.segments.map((function(e,n){var i=c(e,4),o=i[0],s=i[1],r=i[2],l=i[3],a=(r+o)/2,u=(l+s)/2,d=o,h=s+50,f=r,p=l-50,g=180*-Math.atan2(r+f-d-o,l+p-h-s)/Math.PI;g<0&&(g+=360);var m="M ".concat(o,", ").concat(s," C ").concat(d,", ").concat(h,", ").concat(f,", ").concat(p,", ").concat(r,", ").concat(l),v="translate(".concat(a,", ").concat(u,") rotate(").concat(g,") scale(").concat(t.options.scale,")");return{key:n,path:m,transform:v}}))},pathStyle:function(){return{stroke:this.color||this.options.themeColor,strokeWidth:this.options.linkWidth*this.options.scale,fill:"none"}},deleteStyle:function(){return{stroke:this.options.labelColor,strokeWidth:.8*this.options.linkWidth,fill:"none"}},arrowStyle:function(){return{stroke:this.color||this.options.themeColor,strokeWidth:2*this.options.linkWidth,fill:"none"}}}},f=h;n("7b97");function p(t,e,n,i,o,s,r,l){var c,a="function"===typeof t?t.options:t;if(e&&(a.render=e,a.staticRenderFns=n,a._compiled=!0),i&&(a.functional=!0),s&&(a._scopeId="data-v-"+s),r?(c=function(t){t=t||this.$vnode&&this.$vnode.ssrContext||this.parent&&this.parent.$vnode&&this.parent.$vnode.ssrContext,t||"undefined"===typeof __VUE_SSR_CONTEXT__||(t=__VUE_SSR_CONTEXT__),o&&o.call(this,t),t&&t._registeredComponents&&t._registeredComponents.add(r)},a._ssrRegister=c):o&&(c=l?function(){o.call(this,this.$root.$options.shadowRoot)}:o),c)if(a.functional){a._injectStyles=c;var u=a.render;a.render=function(t,e){return c.call(e),u(t,e)}}else{var d=a.beforeCreate;a.beforeCreate=d?[].concat(d,c):[c]}return{exports:t,options:a}}var g=p(f,r,l,!1,null,"796da41e",null),m=g.exports,v=function(){var t=this,e=t.$createElement,n=t._self._c||e;return n("div",{staticClass:"flowchart-node",class:[{selected:t.isSelected},t.options.orientation],style:t.nodeStyle,on:{mousedown:function(e){return e.preventDefault(),t.handleMousedown(e)},mouseenter:t.handleMouseEnter,mouseleave:t.handleMouseLeave}},[n("div",{staticClass:"node-port node-input",on:{mousedown:t.inputMouseDown,mouseup:function(e){return e.preventDefault(),t.inputMouseUp(e)},mousemove:t.inputMouseMove}}),n("div",{staticClass:"node-main"},[n("div",{staticClass:"node-type",domProps:{textContent:t._s(t.type)}}),n("div",{staticClass:"node-label",domProps:{textContent:t._s(t.label)}})]),n("div",{staticClass:"node-port node-output",on:{mousedown:function(e){return e.preventDefault(),t.outputMouseDown(e)}}}),n("div",{directives:[{name:"show",rawName:"v-show",value:t.show.delete,expression:"show.delete"}],staticClass:"node-delete"},[t._v("Ã—")])])},y=[],k={name:"FlowchartNode",props:{id:{default:1e3},x:{type:Number,default:0,validator:function(t){return"number"===typeof t}},y:{type:Number,default:0,validator:function(t){return"number"===typeof t}},type:{type:String,default:"Default"},label:{type:String,default:"input name"},borderColor:String,options:{type:Object,default:function(){return{centerX:1024,centerY:140,scale:1,selected:[],orientation:"vert",width:80,height:80,themeColor:"",nodeBgColor:"",typeColor:"",labelColor:"",canDelete:!0}}}},data:function(){return{show:{delete:!1}}},computed:{isSelected:function(){return this.options.selected.includes(this.id)},nodeStyle:function(){var t={top:this.options.centerY+this.y*this.options.scale+"px",left:this.options.centerX+this.x*this.options.scale+"px",transform:"scale(".concat(this.options.scale,")"),width:this.options.width+"px",height:this.options.height+"px","--theme-color":this.options.themeColor,"--node-bgcolor":this.options.nodeBgColor,"--type-color":this.options.typeColor,"--label-color":this.options.labelColor};return this.borderColor&&!this.isSelected&&(t["box-shadow"]="0 0 0 2px ".concat(this.borderColor)),t}},methods:{handleMousedown:function(t){var e=t.target||t.srcElement;e.className.indexOf("node-input")<0&&e.className.indexOf("node-output")<0&&this.$emit("nodeSelected",t)},handleMouseEnter:function(){this.options.canDelete&&(this.show.delete=!0),this.$emit("nodeMouseEnter")},handleMouseLeave:function(){this.options.canDelete&&(this.show.delete=!1),this.$emit("nodeMouseLeave")},outputMouseDown:function(){this.$emit("linkingStart")},inputMouseDown:function(t){t.preventDefault()},inputMouseUp:function(){this.$emit("linkingStop")},inputMouseMove:function(){this.$emit("tryLinking")}}},b=k,w=(n("f579"),p(b,v,y,!1,null,"16321d16",null)),C=w.exports;function S(t){var e=t.getBoundingClientRect(),n=window.pageYOffset,i=window.pageXOffset,o=e.top+n,s=e.left+i;return{top:Math.round(o),left:Math.round(s)}}function M(t,e){var n=e.pageX||e.clientX+document.documentElement.scrollLeft,i=e.pageY||e.clientY+document.documentElement.scrollTop,o=S(t),s=n-o.left,r=i-o.top;return[s,r]}function L(t,e){return $(t)||x(t,e)||O()}function O(){throw new TypeError("Invalid attempt to destructure non-iterable instance")}function x(t,e){if(Symbol.iterator in Object(t)||"[object Arguments]"===Object.prototype.toString.call(t)){var n=[],i=!0,o=!1,s=void 0;try{for(var r,l=t[Symbol.iterator]();!(i=(r=l.next()).done);i=!0)if(n.push(r.value),e&&n.length===e)break}catch(c){o=!0,s=c}finally{try{i||null==l["return"]||l["return"]()}finally{if(o)throw s}}return n}}function $(t){if(Array.isArray(t))return t}function D(t){return j(t)||E(t)||N()}function N(){throw new TypeError("Invalid attempt to spread non-iterable instance")}function E(t){if(Symbol.iterator in Object(t)||"[object Arguments]"===Object.prototype.toString.call(t))return Array.from(t)}function j(t){if(Array.isArray(t)){for(var e=0,n=new Array(t.length);e<t.length;e++)n[e]=t[e];return n}}function _(t,e){var n=Object.keys(t);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(t);e&&(i=i.filter((function(e){return Object.getOwnPropertyDescriptor(t,e).enumerable}))),n.push.apply(n,i)}return n}function P(t){for(var e=1;e<arguments.length;e++){var n=null!=arguments[e]?arguments[e]:{};e%2?_(Object(n),!0).forEach((function(e){I(t,e,n[e])})):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(n)):_(Object(n)).forEach((function(e){Object.defineProperty(t,e,Object.getOwnPropertyDescriptor(n,e))}))}return t}function I(t,e,n){return e in t?Object.defineProperty(t,e,{value:n,enumerable:!0,configurable:!0,writable:!0}):t[e]=n,t}var A=80,X=80,Y="#ff8855",W="#fff",T="#fff",B="#2c3e50",U=2.73205,R=8,F=100,H={name:"VueLightFlowchart",props:{scene:{type:Object,default:function(){return{centerX:1024,centerY:140,scale:1,nodes:[],links:[],orientation:"vert",showDeleteNode:!0,showDeleteLink:!0,styles:{nodeWidth:A,nodeHeight:X,themeColor:Y,nodeBgColor:W,typeColor:T,labelColor:B,linkWidth:U}}}},height:{type:Number,default:400}},data:function(){return{action:{linking:!1,dragging:!1,scrolling:!1,selected:[]},mouse:{x:0,y:0,lastX:0,lastY:0},draggingLink:null,rootDivOffset:{top:0,left:0}}},components:{FlowchartLink:m,FlowchartNode:C},watch:{"scene.nodes":{handler:"setNodes",immediate:!0}},computed:{scale:function(){return this.scene.scale||1},orientation:function(){return this.scene.orientation||"vert"},styles:function(){return P({},{nodeWidth:A,nodeHeight:X,themeColor:Y,nodeBgColor:W,typeColor:T,labelColor:B,linkWidth:U},{},this.scene.styles)},nodeOptions:function(){return{centerY:this.scene.centerY,centerX:this.scene.centerX,scale:this.scale,selected:this.action.selected,orientation:this.orientation,width:this.styles.nodeWidth,height:this.styles.nodeHeight,themeColor:this.styles.themeColor,nodeBgColor:this.styles.nodeBgColor,typeColor:this.styles.typeColor,labelColor:this.styles.labelColor,canDelete:this.scene.showDeleteNode}},linkOptions:function(){return{scale:this.scale,themeColor:this.styles.themeColor,labelColor:this.styles.labelColor,linkWidth:this.styles.linkWidth,canDelete:this.scene.showDeleteLink}},lines:function(){var t=this,e=this.scene.links.map((function(e){var n=e.nodes,i=e.id,o=e.color;return{segments:t.getSegments(n),id:i,color:o}}));if(this.draggingLink){var n=[],i=this.findNode(this.draggingLink.lastNodeId),o=this.draggingLink.nodes;if(o.length>0){n.push.apply(n,D(this.getSegments(o)));var s=this.findNode(o[o.length-1]),r=this.getPortPosition(s,"output"),l=L(r,2),c=l[0],a=l[1],u=this.getPortPosition(i,"input"),d=L(u,2),h=d[0],f=d[1];n.push([c,a,h,f])}var p=this.getPortPosition(i,"output"),g=L(p,2),m=g[0],v=g[1];n.push([m,v,this.draggingLink.mx,this.draggingLink.my]),e.push({segments:n})}return e}},mounted:function(){this.rootDivOffset.top=this.$el?this.$el.offsetTop:0,this.rootDivOffset.left=this.$el?this.$el.offsetLeft:0,this.select={lastClickedId:null,isCtrlClick:!1,isClickedSelected:!1,wasDragging:!1}},methods:{setNodes:function(){var t=this;this.nodes=new Map,this.scene.nodes.forEach((function(e){return t.nodes[e.id]=e}))},findNode:function(t){return this.nodes[t]},getSegments:function(t){for(var e=[],n=this.findNode(t[0]),i=1;i<t.length;i++){var o=this.findNode(t[i]),s=this.getPortPosition(n,"output"),r=L(s,2),l=r[0],c=r[1],a=this.getPortPosition(o,"input"),u=L(a,2),d=u[0],h=u[1];e.push([l,c,d,h]),n=o}return e},getPortPosition:function(t,e){var n=this.orientation,i=this.scale,o=this.scene.centerX+t.x*i,s=this.scene.centerY+t.y*i,r=this.styles.nodeWidth,l=this.styles.nodeHeight;if("vert"===n){var c=o+r/2*i;return"input"===e?[c,s]:[c,s+l*i]}var a=s+l/2*i;return"input"===e?[o,a]:[o+r*i,a]},linkingStart:function(t){var e=this.findNode(t),n=this.getPortPosition(e,"output"),i=L(n,2),o=i[0],s=i[1];this.action.linking=!0,this.draggingLink={nodes:[],lastNodeId:t,mx:o,my:s}},tryAddNodeToLink:function(t){var e=this.draggingLink;e&&(e.lastNodeId===t||this.isLinkIntersections(e,t)||(e.nodes.push(e.lastNodeId),e.lastNodeId=t))},linkingStop:function(t){var e=this.draggingLink;if(e&&(this.draggingLink=null,t===e.lastNodeId&&!this.isLinkIntersections(e,t)&&(e.nodes.push(t),!this.isLinkExists(e)))){var n=Math.max.apply(Math,[0].concat(D(this.scene.links.map((function(t){return t.id}))))),i={id:n+1,nodes:e.nodes};this.scene.links.push(i),this.$emit("linkAdded",i)}},isLinkIntersections:function(t,e){return t.nodes.some((function(t){return t===e}))},isLinkExists:function(t){return this.scene.links.some((function(e){var n=e.nodes;return t.nodes.length===n.length&&t.nodes.every((function(t,e){return t===n[e]}))}))},linkClick:function(t){this.$emit("linkClick",this.findLink(t))},linkDelete:function(t){var e=this.findLink(t);e&&(this.scene.links=this.scene.links.filter((function(e){return e.id!==t})),this.$emit("linkBreak",e))},linkMouseEnter:function(t){this.action.dragging||this.$emit("linkMouseEnter",this.findLink(t))},linkMouseLeave:function(t){this.action.dragging||this.$emit("linkMouseLeave",this.findLink(t))},findLink:function(t){return this.scene.links.find((function(e){return e.id===t}))},nodeSelected:function(t,e){this.select={lastClickedId:t,isCtrlClick:e.ctrlKey&&!e.shiftKey&&!e.altKey&&!e.metaKey,isClickedSelected:this.action.selected.includes(t),wasDragging:!1},this.action.dragging=!0,this.selectNodeOnDown(t),this.$emit("nodeClick",t);var n=M(this.$el,e),i=L(n,2);this.mouse.lastX=i[0],this.mouse.lastY=i[1]},handleMove:function(t){if(this.action.linking){var e=M(this.$el,t),n=L(e,2);this.draggingLink.mx=n[0],this.draggingLink.my=n[1],this.mouse.lastEvent=t,this.startAutoScroll()}else if(this.action.dragging){var i=M(this.$el,t),o=L(i,2),s=o[0],r=o[1],l=s-this.mouse.lastX,c=r-this.mouse.lastY;this.mouse.lastX=s,this.mouse.lastY=r,this.mouse.lastEvent=t,this.moveSelectedNodes(l,c),this.select.wasDragging=!0,this.startAutoScroll()}else if(this.action.scrolling){var a=M(this.$el,t),u=L(a,2),d=u[0],h=u[1],f=d-this.mouse.lastX,p=h-this.mouse.lastY;this.mouse.lastX=d,this.mouse.lastY=h,this.scene.centerX+=f,this.scene.centerY+=p}},handleDown:function(t){var e=t.target||t.srcElement;if((e===this.$el||e.matches("svg, svg *"))&&1===t.which){this.action.scrolling=!0;var n=M(this.$el,t),i=L(n,2);this.mouse.lastX=i[0],this.mouse.lastY=i[1],this.action.selected=[]}this.$emit("canvasClick",t)},handleUp:function(t){var e=t.target||t.srcElement;this.$el.contains(e)&&(("string"!==typeof e.className||e.className.indexOf("node-input")<0)&&(this.draggingLink=null),this.scene.showDeleteNode&&"string"===typeof e.className&&e.className.indexOf("node-delete")>-1&&this.nodeDelete(this.select.lastClickedId)),this.selectNodeOnUp(),this.action.linking=!1,this.action.dragging=!1,this.action.scrolling=!1,this.stopAutoScroll()},selectNodeOnDown:function(t){var e=this.select,n=e.isClickedSelected,i=e.isCtrlClick;n||(i?this.action.selected.push(t):this.action.selected=[t])},selectNodeOnUp:function(){var t=this.select,e=t.wasDragging,n=t.isClickedSelected,i=t.isCtrlClick,o=t.lastClickedId;e||n&&(this.action.selected=i?this.action.selected.filter((function(t){return t!==o})):[o])},moveSelectedNodes:function(t,e){var n=this;this.scene.nodes.forEach((function(i,o){if(n.action.selected.includes(i.id)){var s=i.x+t/n.scale,r=i.y+e/n.scale;n.$set(n.scene.nodes,o,Object.assign(i,{x:s,y:r}))}}))},startAutoScroll:function(){this.autoScrollId||(this.autoScrollId=setInterval(this.autoScroll.bind(this),F))},stopAutoScroll:function(){this.autoScrollId&&(clearInterval(this.autoScrollId),this.autoScrollId=null)},autoScroll:function(){var t=M(this.$el,this.mouse.lastEvent),e=L(t,2),n=e[0],i=e[1],o=this.$el.getBoundingClientRect(),s=o.width,r=o.height,l=this.styles.nodeWidth/2,c=this.styles.nodeHeight/2,a=0,u=0;n<l?a=-R:s-n<l&&(a=R),i<c?u=-R:r-i<c&&(u=R),0===a&&0===u||(this.moveSelectedNodes(a,u),this.scene.centerX-=a,this.scene.centerY-=u)},nodeDelete:function(t){this.scene.nodes=this.scene.nodes.filter((function(e){return e.id!==t})),this.scene.links=this.scene.links.filter((function(e){return!e.nodes.some((function(e){return e===t}))})),this.$emit("nodeDelete",t)},nodeMouseEnter:function(t){this.action.dragging||this.$emit("nodeMouseEnter",t)},nodeMouseLeave:function(t){this.action.dragging||this.$emit("nodeMouseLeave",t)}}},K=H,V=(n("2aee"),p(K,o,s,!1,null,"7f444b57",null)),z=V.exports,q=z;e["default"]=q}})}));
//# sourceMappingURL=vue-light-flowchart.umd.min.js.map